<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">
        <title>
            GoodBooks <h:outputText value=" | #{bookBean.book.title} by #{bookBean.book.author.name}" rendered="#{not empty bookBean.book.id}"/>
        </title>
    </ui:define>
	<ui:define name="body">
		<f:metadata>
			<f:viewParam name="id" value="#{bookBean.id}" />
			<f:event type="preRenderView" listener="#{bookBean.init()}" />
		</f:metadata>
		<h:form id="bookForm">
			<p:panel styleClass="book-panel" rendered="#{not empty bookBean.book.id}">
				<div class="book-image">
					<div class="book-cover">
						<p:graphicImage width="50%" height="50%" value="/resources/images/no_image_available.jpg" />
					</div>
					<p:spacer height="2%" width="100%" />
					<p:rating value="#{bookBean.bookRating.rating}" readonly="#{!loginBean.loggedOn}" id="bookRatingId">
						<p:ajax event="rate" listener="#{bookBean.addRating()}" update="bookForm" />
						<p:ajax event="cancel" listener="#{bookBean.removeRating()}" update="bookForm" />
					</p:rating>
					<p:spacer height="2%" width="100%" />
					<p:selectOneMenu disabled="#{not loginBean.loggedOn}">
						<f:selectItem itemValue="-1" itemLabel="Book Status" />
						<f:selectItems value="#{bookBean.statuses}" />
					</p:selectOneMenu>
					<p:spacer height="2%" width="100%" />
					<p:commandButton value="Write a Review" action="#" />
				</div>
				<div class="book-details">
					<p:panel styleClass="book-ratings-panel">
						<h:outputText value="avg. rating: " />
						<h:outputText value="#{bookBean.averageRating}" />
						|
						<h:outputText value="#{bookBean.numberOfRatings}" styleClass="book-ratings-totalRatings" />
						<h:outputText value="#{bookBean.numberOfRatings eq 1 ? ' rating' : ' ratings'} "
							styleClass="book-ratings-totalRatings" />
					</p:panel>
					<p:spacer width="100%" height="1%" />
					<h:outputText value="#{bookBean.book.title}" styleClass="book-title" />
					<br />
					<h:outputText value="by" />
					<p:button value="#{bookBean.book.author.name}" outcome="#{navigationBean.author()}" styleClass="book-author-name">
						<f:param name="id" value="#{bookBean.book.author.id}" />
						<f:param name="author" value="#{bookBean.book.author.name}" />
					</p:button>
					<br />
					<p:spacer width="100%" height="2%" />
					<h:outputText value="#{bookBean.book.description}" />
					<br />
					<p:spacer width="100%" height="2%" />
					<p:separator />
					<p:panelGrid>
						<p:row>
							<p:column>
								<h:outputText value="ISBN-13" />
							</p:column>
							<p:column>
								<h:outputText value="#{bookBean.book.isbn}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<h:outputText value="Published" />
							</p:column>
							<p:column>
								<h:outputText value="#{bookBean.book.publishDate}" >
									<f:convertDateTime pattern="dd MMMM yyyy" />
								</h:outputText>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<h:outputText value="Language" />
							</p:column>
							<p:column>
								<h:outputText value="#{bookBean.book.language.toString()}" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</div>
			</p:panel>
			<div class="book-comments">
				<p:dataGrid rows="10" paginator="true" columns="1" value="#{bookBean.lazyDataModel}" var="review"
					paginatorPosition="bottom" lazy="true"
					paginatorTemplate="Page {CurrentPageReport} Go to page: {JumpToPageDropdown} {PreviousPageLink} {NextPageLink}"
					rowsPerPageTemplate="10" rendered="#{not empty bookBean.book.id}">
					<f:facet name="header">
						<h:outputText value="Comments" />
					</f:facet>
					<p:separator/>
					<p:row>
						<p:column>
							<div class="book-review">
								<p:commandLink value="#{review.customer.username}" styleClass="book-review-username"/>
								<h:outputText value="rated it" styleClass="float-left" />
								<p:rating value="#{review.rating}" styleClass="book-review-rating" readonly="true">
								</p:rating>
								<h:outputText value="#{review.publishDate}" styleClass="book-review-date">
									<f:convertDateTime pattern="dd MMM yyyy" />
								</h:outputText>
								<br /> <br />
								<h:outputText value="#{review.comment}" />
								<br /> <br />
								<h:outputText value="#{review.likes} likes" styleClass="book-review-likes" />
							</div>
						</p:column>
					</p:row>
				</p:dataGrid>
			</div>
			<div class="center">
				<p:messages globalOnly="true" />
			</div>
		</h:form>
	</ui:define>
</ui:composition>
</html>
